stages:
  - build

build_tarball:
  stage: build
  tags:
    - shell
  script:
    - mkdir -p build
    - cmake -B build -S .
    - cmake --build build --parallel
    # Optional: Ausgabe prüfen
    - ls -lh build/bin/de/agundur/kcast/libkcastplugin.so || (echo "❌ .so not found!" && exit 1)
    - ls -lh package/metadata.json || (echo "❌ metadata.json not found!" && exit 1)
    - ls -lh package/ui || (echo "❌ UI directory not found!" && exit 1)
    # Archiv erzeugen
    - mkdir -p dist
    - tar czf dist/kcast-runtime.tar.gz \
        build/bin/de/agundur/kcast/libkcastplugin.so \
        package/metadata.json \
        package/ui
  artifacts:
    paths:
      - dist/kcast-runtime.tar.gz
    expire_in: 1 day
