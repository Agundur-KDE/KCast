stages:
  - build

variables:
  BUILD_DIR: build
  ARTIFACT_PATH: dist
  ARTIFACT_NAME: kcast-runtime.tar.gz

build_tarball:
  stage: build
  tags: ["shell"]  # dein Runner-Tag
  only:
    - tags
  script:

    - cmake -B $BUILD_DIR -DCMAKE_BUILD_TYPE=Release
    - cmake --build $BUILD_DIR --parallel
    - echo "üìÅ √úberpr√ºfe Artefakt-Komponenten"
    - test -f $BUILD_DIR/bin/de/agundur/kcast/libkcastplugin.so
    - test -f package/metadata.json
    - test -d package/contents/ui
    - echo "üì¶ Erstelle Tarball"
    - mkdir -p $ARTIFACT_PATH
    - tar czf $ARTIFACT_PATH/$ARTIFACT_NAME \
        $BUILD_DIR/bin/de/agundur/kcast/libkcastplugin.so \
        package/metadata.json \
        package/contents/ui
  artifacts:
    name: "$ARTIFACT_NAME"
    paths:
      - $ARTIFACT_PATH/$ARTIFACT_NAME
    expire_in: 1 week
