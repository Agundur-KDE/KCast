stages:
  - build

variables:
  BUILD_DIR: "build"
  ARTIFACT_PATH: "dist"
  ARTIFACT_NAME: "kcast-runtime.tar.gz"

# Nur auf Tags triggern
build_tarball:
  stage: build
  only:
    - tags
  tags:
    - shell
script:
  - echo "üîß Erstelle Build-Verzeichnis:"
  - echo "$BUILD_DIR"
  - mkdir -p "$BUILD_DIR"
  - echo "üõ†Ô∏è Starte CMake-Konfiguration"
  - cmake -B "$BUILD_DIR" -DCMAKE_BUILD_TYPE=Release
  - echo "‚öôÔ∏è Baue Projekt"
  - cmake --build "$BUILD_DIR" --parallel
  - echo "üìÅ √úberpr√ºfe Artefakt-Komponenten"
  - test -f "$BUILD_DIR/bin/de/agundur/kcast/libkcastplugin.so"
  - test -f package/metadata.json
  - test -d package/contents/ui
  - echo "üì¶ Erstelle Tarball"
  - mkdir -p "$ARTIFACT_PATH"
  - tar czf "$ARTIFACT_PATH/$ARTIFACT_NAME""$BUILD_DIR/bin/de/agundur/kcast/libkcastplugin.so""package/metadata.json""package/contents/ui"
  - echo "‚úÖ Fertig gebaut:"
  - echo "$ARTIFACT_PATH/$ARTIFACT_NAME"


  artifacts:
    paths:
      - "${ARTIFACT_PATH}/${ARTIFACT_NAME}"
    expire_in: 1 week
