stages:
  - build

variables:
  BUILD_DIR: "build"
  ARTIFACT_PATH: "dist"
  ARTIFACT_NAME: "kcast-runtime.tar.gz"

# Nur auf Tags triggern
build_tarball:
  stage: build
  only:
    - tags
  tags:
    - shell
script:
  - echo "ðŸ”§ Erstelle Build-Verzeichnis:"
  - echo "$BUILD_DIR"
  - mkdir -p "$BUILD_DIR"
  - echo "ðŸ› ï¸ Starte CMake-Konfiguration"
  - cmake -B "$BUILD_DIR" -DCMAKE_BUILD_TYPE=Release
  - echo "âš™ï¸ Baue Projekt"
  - cmake --build "$BUILD_DIR" --parallel
  - echo "ðŸ“ ÃœberprÃ¼fe Artefakt-Komponenten"
  - test -f "$BUILD_DIR/bin/de/agundur/kcast/libkcastplugin.so"
  - test -f package/metadata.json
  - test -d package/contents/ui
  - echo "ðŸ“¦ Erstelle Tarball"
  - mkdir -p "$ARTIFACT_PATH"
  - >
    tar czf "$ARTIFACT_PATH/$ARTIFACT_NAME"
    "$BUILD_DIR/bin/de/agundur/kcast/libkcastplugin.so"
    "package/metadata.json"
    "package/contents/ui"
  - echo "âœ… Fertig gebaut:"
  - echo "$ARTIFACT_PATH/$ARTIFACT_NAME"


  artifacts:
    paths:
      - "${ARTIFACT_PATH}/${ARTIFACT_NAME}"
    expire_in: 1 week
